-- Silent Aim BlockSpin FIXÃ‰ POUR XENO (HookMetamethod Universel + HRP Pred)
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local SilentAimEnabled = true
local FOV = 150

local GunNames = {
    "P226","MP5","M24","Draco","Glock","Sawnoff","Uzi","G3","C9",
    "Hunting Rifle","Anaconda","AK47","Remington","Double Barrel"
}
local GunLookup = {}
for _, name in pairs(GunNames) do GunLookup[name] = true end

-- FOV + Tracer
local fovCircle = Drawing.new("Circle")
fovCircle.Color = Color3.new(1,1,1)
fovCircle.Thickness = 2
fovCircle.NumSides = 100
fovCircle.Radius = FOV
fovCircle.Filled = false
fovCircle.Visible = true
fovCircle.Transparency = 1

local tracerLine = Drawing.new("Line")
tracerLine.Color = Color3.new(1,0,0)
tracerLine.Thickness = 2
tracerLine.Visible = false
tracerLine.Transparency = 1

-- Fonctions (GetClosest, Predict, IsGun)
local function GetClosestTarget()
    local closest, shortest = nil, math.huge
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local root = player.Character.HumanoidRootPart
            local screenPos, onScreen = Camera:WorldToViewportPoint(root.Position)
            if onScreen then
                local dist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
                if dist < FOV and dist < shortest then
                    shortest = dist
                    closest = player
                end
            end
        end
    end
    return closest
end

local function PredictPosition(rootPart)
    if not rootPart then return Vector3.new(0,0,0) end
    local velocity = rootPart.Velocity
    local prediction = rootPart.Position + (velocity * 0.165)
    local seat = rootPart:FindFirstChildWhichIsA("WeldConstraint") or rootPart:FindFirstChildWhichIsA("Weld")
    if seat and seat.Part0 then
        prediction = rootPart.Position + (seat.Part0.Velocity * 0.165 * 1.2)
    end
    return prediction
end

local function IsHoldingAllowedGun(args)
    local ok, weapon = pcall(function() return args[3] end)
    if ok and typeof(weapon) == "Instance" and GunLookup[weapon.Name] then return true end
    if LocalPlayer.Character then
        for _, child in pairs(LocalPlayer.Character:GetChildren()) do
            if (child:IsA("Tool") or child:IsA("Model")) and GunLookup[child.Name] then
                return true
            end
        end
    end
    return false
end

-- Position initiale + Boucle (marche direct)
local function updateFOV()
    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    fovCircle.Position = center
    fovCircle.Radius = FOV
end
updateFOV()

RunService.RenderStepped:Connect(function()
    updateFOV()
    local target = GetClosestTarget()
    if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
        local predPos = PredictPosition(target.Character.HumanoidRootPart)
        local screenPos, onScreen = Camera:WorldToViewportPoint(predPos)
        if onScreen then
            local ourHead = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Head")
            if ourHead then
                local screenStart = Camera:WorldToViewportPoint(ourHead.Position)
                tracerLine.From = Vector2.new(screenStart.X, screenStart.Y)
                tracerLine.To = Vector2.new(screenPos.X, screenPos.Y)
                tracerLine.Visible = true
                return
            end
        end
    end
    tracerLine.Visible = false
end)

-- ðŸ”¥ SILENT AIM HOOKMETAMETHOD (UNIVERSAL - MARCHE SUR XENO/BLOCKSPIN)
if hookmetamethod then
    local mt = getrawmetatable(game)
    local oldNamecall = mt.__namecall
    setreadonly(mt, false)
    mt.__namecall = newcclosure(function(self, ...)
        local args = {...}
        local method = getnamecallmethod()
        
        if SilentAimEnabled and method == "FireServer" and not checkcaller() and IsHoldingAllowedGun(args) then
            local target = GetClosestTarget()
            if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                local root = target.Character.HumanoidRootPart
                local aimPos = PredictPosition(root)
                
                -- Modifie args comme original (BlockSpin format)
                args[4] = CFrame.new(1/0,1/0,1/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0)
                args[5] = {[1]={[1]={["Instance"]=root, ["Position"]=aimPos}}}
                
                print("ðŸ”¥ SILENT AIM TRIGGER sur " .. target.Name)  -- Debug console F9
            end
        end
        
        return oldNamecall(self, unpack(args))
    end)
    setreadonly(mt, true)
    print("âœ… HOOKMETAMETHOD SILENT AIM ACTIF (Xeno OK !)")
else
    warn("âŒ hookmetamethod non supportÃ© (mauvais executor ?)")
end

print("Silent Aim BlockSpin XENO FIXÃ‰ ! FOV + Tracer + Pred HRP") 
