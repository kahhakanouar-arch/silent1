local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local Enabled = true
local Cache = {}

-- Table de correspondance pour BlockSpin (ID vers Nom Réel)
local WEAPON_NAMES = {
    ["1"] = "M16",
    ["2"] = "AK47",
    ["3"] = "MP5",
    ["4"] = "Remington",
    ["5"] = "Crossbow",
    ["6"] = "RPG",
    ["7"] = "Tactical Shovel",
    ["8"] = "Tactical Axe",
    -- Le script cherchera aussi dynamiquement si l'ID n'est pas ici
}

local COLORS = {
    Common = Color3.fromRGB(255, 255, 255),
    Uncommon = Color3.fromRGB(99, 255, 52),
    Rare = Color3.fromRGB(51, 170, 255),
    Epic = Color3.fromRGB(237, 44, 255),
    Legendary = Color3.fromRGB(255, 150, 0),
    Omega = Color3.fromRGB(255, 20, 51)
}

local function GetRealName(t)
    -- 1. Vérification dans la table de traduction (si le nom est un ID)
    if WEAPON_NAMES[t.Name] then 
        return WEAPON_NAMES[t.Name] 
    end

    -- 2. Vérification des attributs du jeu
    local attr = t:GetAttribute("ItemName") or t:GetAttribute("DisplayName")
    if attr and tostring(attr) ~= "" and not tonumber(tostring(attr)) then 
        return tostring(attr) 
    end

    -- 3. Recherche d'une valeur texte interne
    local val = t:FindFirstChild("Name") or t:FindFirstChild("WeaponName")
    if val and val:IsA("StringValue") and val.Value ~= "" then
        return val.Value
    end

    -- 4. Retour par défaut (on évite d'afficher juste un chiffre si possible)
    return (tonumber(t.Name) and "Arme " .. t.Name) or t.Name
end

local function Update(p)
    local b = Cache[p]
    if not b then return end
    local c = b:FindFirstChild("Container")
    if not c then return end
    c:ClearAllChildren()
    
    local l = Instance.new("UIListLayout", c)
    l.FillDirection = Enum.FillDirection.Horizontal
    l.HorizontalAlignment = Enum.HorizontalAlignment.Center
    l.Padding = UDim.new(0, 5)

    local items = {}
    if p.Character then
        for _, o in ipairs(p.Character:GetChildren()) do
            if o:IsA("Tool") and o.Name ~= "Fists" then table.insert(items, o) end
        end
    end
    local bp = p:FindFirstChild("Backpack")
    if bp then
        for _, o in ipairs(bp:GetChildren()) do
            if o:IsA("Tool") and o.Name ~= "Fists" then table.insert(items, o) end
        end
    end

    b.Enabled = Enabled and (#items > 0)
    for _, t in ipairs(items) do
        local txt = Instance.new("TextLabel", c)
        txt.Size = UDim2.new(0, 110, 0, 30)
        txt.BackgroundTransparency = 1
        txt.Text = GetRealName(t)
        
        local r = t:GetAttribute("RarityName") or t:GetAttribute("Rarity") or "Common"
        txt.TextColor3 = COLORS[r] or Color3.new(1,1,1)
        txt.Font = Enum.Font.GothamBold
        txt.TextScaled = true
        txt.TextStrokeTransparency = 0.5
    end
end

local function Create(p)
    if p == LP then return end
    local function setup(char)
        local hrp = char:WaitForChild("HumanoidRootPart", 10)
        if not hrp then return end
        if Cache[p] then Cache[p]:Destroy() end
        
        local b = Instance.new("BillboardGui", hrp)
        b.Name = "BlockSpinESP"
        b.Size = UDim2.new(0, 400, 0, 50)
        b.StudsOffset = Vector3.new(0, -4.5, 0) -- Sous les pieds
        b.AlwaysOnTop = true
        
        local c = Instance.new("Frame", b)
        c.Name = "Container"
        c.Size = UDim2.new(1, 0, 1, 0)
        c.BackgroundTransparency = 1
        Cache[p] = b
        
        task.spawn(function()
            while char.Parent and b.Parent do
                Update(p)
                task.wait(1.2)
            end
        end)
    end
    p.CharacterAdded:Connect(setup)
    if p.Character then task.spawn(setup, p.Character) end
end

for _, p in ipairs(Players:GetPlayers()) do Create(p) end
Players.PlayerAdded:Connect(Create)

local sg = Instance.new("ScreenGui", LP.PlayerGui)
local btn = Instance.new("TextButton", sg)
btn.Size = UDim2.new(0, 100, 0, 35)
btn.Position = UDim2.new(0, 10, 0, 10)
btn.Text = "ESP ARMES"
btn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
btn.Font = Enum.Font.GothamBold
btn.TextColor3 = Color3.new(1,1,1)
btn.MouseButton1Click:Connect(function()
    Enabled = not Enabled
    btn.BackgroundColor3 = Enabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(150, 0, 0)
end)

print("ESP BlockSpin : Noms d'armes activés.")
