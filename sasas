-- === DROP ITEMS ESP AM√âLIOR√â POUR BLOCK SPIN (FIX 2026) ===
-- PROBL√àME FIX√â : Scan ProximityPrompts (tous les loots/cash ont √ßa !)
-- Toggle: INSERT | Distance: 250 studs
-- Couleurs par raret√© + valeur cash d√©tect√©e !

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

-- === SYST√àME DE COULEURS ===
local RARITY_COLORS = {
    ["Common"] = Color3.fromRGB(255, 255, 255),
    ["Uncommon"] = Color3.fromRGB(99, 255, 52),
    ["Rare"] = Color3.fromRGB(51, 170, 255),
    ["Epic"] = Color3.fromRGB(237, 44, 255),
    ["Legendary"] = Color3.fromRGB(255, 150, 0),
    ["Omega"] = Color3.fromRGB(255, 20, 51),
    ["Cash"] = Color3.fromRGB(0, 255, 0),  -- Vert pour argent
}

local ESP_ENABLED = true
local MAX_DIST = 250
local ESPs = {}

local function getRarity(item)
    local name = item.Name:lower()
    -- D√©tecte raret√© dans nom
    for rarity, _ in pairs(RARITY_COLORS) do
        if rarity ~= "Cash" and name:find(rarity:lower()) then
            return rarity
        end
    end
    -- Cash sp√©cial
    if name:find("cash") or name:find("$") or name:find("money") or name:find("dollar") then
        return "Cash"
    end
    -- StringValue Rarity ou Value
    local rarityVal = item:FindFirstChild("Rarity")
    if rarityVal and rarityVal:IsA("StringValue") then
        return rarityVal.Value
    end
    local valueVal = item:FindFirstChild("Value") or item:FindFirstChildWhichIsA("IntValue")
    if valueVal then
        return "Cash"  -- Si valeur, c'est du cash
    end
    return "Common"
end

local function createESP(part)
    if not part or not part.Parent then return end
    local rarity = getRarity(part)
    local color = RARITY_COLORS[rarity] or RARITY_COLORS.Common

    -- Highlight sur la Part
    local highlight = Instance.new("Highlight")
    highlight.FillColor = color
    highlight.OutlineColor = color
    highlight.FillTransparency = 0.3
    highlight.OutlineTransparency = 0
    highlight.Parent = part

    -- BillboardGui
    local bill = Instance.new("BillboardGui")
    bill.Name = "LootESP"
    bill.Adornee = part
    bill.Size = UDim2.new(0, 200, 0, 50)
    bill.StudsOffset = Vector3.new(0, 3, 0)
    bill.AlwaysOnTop = true
    bill.Parent = part

    local frame = Instance.new("Frame", bill)
    frame.Size = UDim2.new(1,0,1,0)
    frame.BackgroundColor3 = Color3.new(0,0,0)
    frame.BackgroundTransparency = 0.4
    frame.BorderSizePixel = 0

    local corner = Instance.new("UICorner", frame)
    corner.CornerRadius = UDim.new(0, 6)

    local nameLabel = Instance.new("TextLabel", frame)
    nameLabel.Size = UDim2.new(1, -8, 0.6, 0)
    nameLabel.Position = UDim2.new(0,4,0,0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = part.Name
    nameLabel.TextColor3 = color
    nameLabel.TextScaled = true
    nameLabel.Font = Enum.Font.GothamBold

    local rarityLabel = Instance.new("TextLabel", frame)
    rarityLabel.Size = UDim2.new(1, -8, 0.4, 0)
    rarityLabel.Position = UDim2.new(0,4,0.6,0)
    rarityLabel.BackgroundTransparency = 1
    rarityLabel.Text = "[" .. rarity .. "]"
    rarityLabel.TextColor3 = color
    rarityLabel.TextScaled = true
    rarityLabel.Font = Enum.Font.Gotham

    ESPs[part] = {highlight = highlight, bill = bill}
end

local function removeESP(part)
    if ESPs[part] then
        ESPs[part].highlight:Destroy()
        ESPs[part].bill:Destroy()
        ESPs[part] = nil
    end
end

-- Boucle OPTIMIS√âE : Scan ProximityPrompts (loots/cash !)
local conn
conn = RunService.Heartbeat:Connect(function()
    if not ESP_ENABLED then return end
    if not LocalPlayer.Character or not LocalPlayer.Character.PrimaryPart then return end

    local lpPos = LocalPlayer.Character.PrimaryPart.Position

    for _, prompt in pairs(workspace:GetDescendants()) do
        if prompt:IsA("ProximityPrompt") and prompt.Parent:IsA("BasePart") then
            local part = prompt.Parent
            local dist = (lpPos - part.Position).Magnitude

            if dist <= MAX_DIST then
                if not ESPs[part] then
                    createESP(part)
                end
            else
                removeESP(part)
            end
        end
    end

    -- Cleanup (items ramass√©s)
    for part, _ in pairs(ESPs) do
        if not part or not part.Parent then
            removeESP(part)
        end
    end
end)

-- Toggle INSERT
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.Insert then
        ESP_ENABLED = not ESP_ENABLED
        if not ESP_ENABLED then
            for part, esp in pairs(ESPs) do
                removeESP(part)
            end
        end
        print("Loot ESP Block Spin: " .. (ESP_ENABLED and "ACTIV√â" or "D√âSACTIV√â"))
    end
end)

print("=== LOOT ESP FIX√â CHARG√â ! SCAN PROXIMITYPROMPTS ===")
print("Appuie INSERT pour toggle | Distance: 250 studs")
print("FONCTIONNE SUR CASH / ARMES / LOOTS DROPP√âS ! üî•")
