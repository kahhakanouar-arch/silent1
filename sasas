-- === DROP WEAPONS ONLY ESP GOLD - DEBUG MODE 2026 ===
-- Ouvre F9 (console) pour voir TOUS les messages !
-- Si rien en F9 → script pas injecté correctement ou executor buggé

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()

local GOLD = Color3.fromRGB(255, 215, 0)

local ENABLED = true
local MAX_DIST = 350
local ESP_TABLE = {}

-- Mots armes (ajoute si tu vois d'autres noms en F9)
local WEAPON_WORDS = {"ak", "mp5", "rpg", "remi", "remington", "draco", "glock", "axe", "tactical", "crossbow", "revolver", "db", "plasma", "p226"}

print("")
print(")

local function isDroppedWeapon(obj)
    if not obj then return false end
    local lowerName = obj.Name:lower()
    
    -- Check mot-clé arme
    local match = false
    for _, word in ipairs(WEAPON_WORDS) do
        if lowerName:find(word) then
            match = true
            break
        end
    end
    if not match then return false end
    
    -- Pas dans un joueur/character
    if obj:IsDescendantOf(game.Players) then return false end
    local ancestor = obj:FindFirstAncestorWhichIsA("Model")
    if ancestor and ancestor:FindFirstChildOfClass("Humanoid") then return false end
    
    -- Doit avoir Handle ou PrimaryPart
    if obj:IsA("Tool") or (obj:IsA("Model") and (obj:FindFirstChild("Handle") or obj.PrimaryPart)) then
        return true
    end
    return false
end

local function addESP(item)
    if ESP_TABLE[item] then return end
    
    local part = item:FindFirstChild("Handle") or item.PrimaryPart or item:FindFirstChildWhichIsA("BasePart")
    if not part then 
        print("Item sans Handle/Part: " .. item.Name .. " → ignoré")
        return 
    end
    
    print("+++ DROP TROUVÉ: " .. item:GetFullName() .. " | Position OK → ESP GOLD ajouté !")
    
    local hl = Instance.new("Highlight", item)
    hl.FillColor = GOLD
    hl.OutlineColor = GOLD
    hl.FillTransparency = 0.4
    hl.OutlineTransparency = 0
    hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    
    local bill = Instance.new("BillboardGui", part)
    bill.Name = "DropESP"
    bill.Adornee = part
    bill.Size = UDim2.new(0, 180, 0, 40)
    bill.StudsOffset = Vector3.new(0, 3, 0)
    bill.AlwaysOnTop = true
    
    local txt = Instance.new("TextLabel", bill)
    txt.Size = UDim2.new(1,0,1,0)
    txt.BackgroundTransparency = 0.6
    txt.BackgroundColor3 = Color3.new(0,0,0)
    txt.Text = item.Name .. " [DROP]"
    txt.TextColor3 = GOLD
    txt.TextScaled = true
    txt.Font = Enum.Font.GothamBold
    
    ESP_TABLE[item] = {highlight = hl, gui = bill}
end

local function removeESP(item)
    if ESP_TABLE[item] then
        ESP_TABLE[item].highlight:Destroy()
        ESP_TABLE[item].gui:Destroy()
        ESP_TABLE[item] = nil
        print("--- ESP supprimé: " .. item.Name)
    end
end

local function scanLoop()
    if not ENABLED then return end
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local rootPos = LocalPlayer.Character.HumanoidRootPart.Position
    
    -- Scan descendants mais limité aux folders probables
    local candidates = {}
    for _, child in ipairs(workspace:GetChildren()) do
        if child:IsA("Folder") or child.Name:lower():find("drop") or child.Name:lower():find("item") or child.Name == "Map" then
            for _, sub in ipairs(child:GetDescendants()) do
                if isDroppedWeapon(sub) then
                    table.insert(candidates, sub)
                end
            end
        end
        if isDroppedWeapon(child) then
            table.insert(candidates, child)
        end
    end
    
    print("Scan: " .. #candidates .. " candidats potentiels trouvés ce tick")
    
    for _, obj in ipairs(candidates) do
        local part = obj:FindFirstChild("Handle") or obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
        if part then
            local dist = (rootPos - part.Position).Magnitude
            if dist <= MAX_DIST then
                addESP(obj)
            else
                removeESP(obj)
            end
        end
    end
    
    -- Cleanup disparus
    for item, _ in pairs(ESP_TABLE) do
        if not item.Parent then
            removeESP(item)
        end
    end
end

RunService.Heartbeat:Connect(scanLoop)

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Insert then
        ENABLED = not ENABLED
        print("ESP DROP: " .. (ENABLED and "ACTIVÉ (gold)" or "DÉSACTIVÉ"))
        if not ENABLED then
            for item,_ in pairs(ESP_TABLE) do removeESP(item) end
        end
    end
end)

-- Pour debug : print workspace structure au démarrage
spawn(function()
    wait(3)
    print("Debug workspace enfants principaux:")
    for _, c in ipairs(workspace:GetChildren()) do
        print(" - " .. c.Name .. " (" .. c.ClassName .. ")")
    end
end)
