-- === DROP WEAPONS ESP ULTIME POUR BLOCK SPIN (L√âGENDAIRES EN GOLD) ===
-- SEULEMENT LES ARMES (pas de cash/money)
-- Toutes les armes d√©tect√©es en GOLD (comme Legendary)
-- Toggle: INSERT | Auto Pickup: RIGHT SHIFT
-- Distance: 300 studs

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

-- COULEUR GOLD POUR TOUTES LES ARMES (L√âGENDAIRE STYLE)
local LEGENDARY_GOLD = Color3.fromRGB(255, 215, 0)  -- Or pur !

local ESP_ENABLED = true
local AUTO_PICKUP = false
local MAX_DIST = 300
local ESPs = {}

-- Mots-cl√©s pour d√©tecter les armes (AK, MP5, RPG, Remi, Draco, etc.)
local WEAPON_KEYWORDS = {
    "ak", "ak47", "mp5", "rpg", "remi", "remington", "draco", "tact", "axe", "tactical axe",
    "crossbow", "revolver", "glock", "db", "double barrel", "c9", "plasma", "lightsaber"  -- Ajoute si nouveaux
}

local function isWeapon(item)
    local name = item.Name:lower()
    for _, keyword in pairs(WEAPON_KEYWORDS) do
        if name:find(keyword) then
            return true
        end
    end
    -- Si c'est un Tool ou Model avec Handle/PrimaryPart et pas cash/money
    if (item:IsA("Tool") or item:IsA("Model")) and not name:find("cash") and not name:find("money") and not name:find("dollar") then
        return true
    end
    return false
end

local function createESP(part)
    if ESPs[part] then return end

    print("üî• ESP CR√â√â POUR ARME: " .. part.Name .. " (GOLD Legendary)")

    -- Highlight GOLD
    local highlight = Instance.new("Highlight")
    highlight.Name = "WeaponESP"
    highlight.FillColor = LEGENDARY_GOLD
    highlight.OutlineColor = LEGENDARY_GOLD
    highlight.FillTransparency = 0.3
    highlight.OutlineTransparency = 0
    highlight.Parent = part

    -- BillboardGui
    local bill = Instance.new("BillboardGui")
    bill.Name = "WeaponESPBill"
    bill.Adornee = part
    bill.Size = UDim2.new(0, 250, 0, 60)
    bill.StudsOffset = Vector3.new(0, 4, 0)
    bill.AlwaysOnTop = true
    bill.Parent = part

    local frame = Instance.new("Frame", bill)
    frame.Size = UDim2.new(1,0,1,0)
    frame.BackgroundColor3 = Color3.new(0,0,0)
    frame.BackgroundTransparency = 0.4
    frame.BorderSizePixel = 0
    local uc = Instance.new("UICorner", frame)
    uc.CornerRadius = UDim.new(0,8)

    local nameLbl = Instance.new("TextLabel", frame)
    nameLbl.Size = UDim2.new(1,-10,0.6,0)
    nameLbl.Position = UDim2.new(0,5,0,0)
    nameLbl.BackgroundTransparency = 1
    nameLbl.Text = part.Name
    nameLbl.TextColor3 = LEGENDARY_GOLD
    nameLbl.TextScaled = true
    nameLbl.Font = Enum.Font.GothamBold

    local typeLbl = Instance.new("TextLabel", frame)
    typeLbl.Size = UDim2.new(1,-10,0.4,0)
    typeLbl.Position = UDim2.new(0,5,0.6,0)
    typeLbl.BackgroundTransparency = 1
    typeLbl.Text = "L√âGENDAIRE DROP"
    typeLbl.TextColor3 = LEGENDARY_GOLD
    typeLbl.TextScaled = true
    typeLbl.Font = Enum.Font.Gotham

    ESPs[part] = {highlight=highlight, bill=bill}
end

local function removeESP(part)
    if ESPs[part] then
        ESPs[part].highlight:Destroy()
        if ESPs[part].bill then ESPs[part].bill:Destroy() end
        ESPs[part] = nil
        print("üóëÔ∏è ESP SUPPRIM√â: " .. part.Name)
    end
end

local function scanWeapons()
    if not ESP_ENABLED then return end
    if not LocalPlayer.Character or not LocalPlayer.Character.PrimaryPart then return end

    local lpPos = LocalPlayer.Character.PrimaryPart.Position
    local toCheck = {}

    -- 1. ProximityPrompts (pickups d'armes)
    for _, prompt in pairs(workspace:GetDescendants()) do
        if prompt:IsA("ProximityPrompt") and prompt.Parent:IsA("BasePart") then
            table.insert(toCheck, prompt.Parent)
        end
    end

    -- 2. Tools dropp√©s (armes)
    for _, tool in pairs(workspace:GetDescendants()) do
        if tool:IsA("Tool") then
            table.insert(toCheck, tool)
        end
    end

    -- 3. Models/Parts avec noms d'armes
    for _, obj in pairs(workspace:GetDescendants()) do
        if (obj:IsA("Model") or obj:IsA("BasePart")) and isWeapon(obj) then
            table.insert(toCheck, obj)
        end
    end

    -- Process seulement les armes
    for _, part in pairs(toCheck) do
        if typeof(part) == "Instance" and part.Parent and isWeapon(part) then
            local handle = part:IsA("Tool") and part:FindFirstChild("Handle") or 
                           part.PrimaryPart or part:FindFirstChild("Handle") or 
                           part:FindFirstChildWhichIsA("BasePart")
            if not handle then continue end

            local pos = handle.Position
            local dist = (lpPos - pos).Magnitude

            if dist <= MAX_DIST then
                createESP(part)
            else
                removeESP(part)
            end
        end
    end

    -- Cleanup auto
    for part, _ in pairs(ESPs) do
        if not part or not part.Parent then
            removeESP(part)
        end
    end
end

-- Boucle scan
RunService.Heartbeat:Connect(scanWeapons)

-- Toggles
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end

    if input.KeyCode == Enum.KeyCode.Insert then
        ESP_ENABLED = not ESP_ENABLED
        print("=== WEAPONS ESP " .. (ESP_ENABLED and "ACTIV√â üî•" or "D√âSACTIV√â") .. " ===")
        if not ESP_ENABLED then
            for part, _ in pairs(ESPs) do removeESP(part) end
        end
    elseif input.KeyCode == Enum.KeyCode.RightShift then
        AUTO_PICKUP = not AUTO_PICKUP
        print("=== AUTO PICKUP " .. (AUTO_PICKUP and "ACTIV√â üòà" or "D√âSACTIV√â") .. " ===")
    end
end)

-- AUTO PICKUP (ramasse auto les armes proches)
spawn(function()
    while true do
        if AUTO_PICKUP and ESP_ENABLED then
            for _, prompt in pairs(workspace:GetDescendants()) do
                if prompt:IsA("ProximityPrompt") then
                    local part = prompt.Parent
                    if part and isWeapon(part) then
                        local dist = (LocalPlayer.Character.PrimaryPart.Position - part.Position).Magnitude
                        if dist < 12 then
                            fireproximityprompt(prompt)
                        end
                    end
                end
            end
        end
        wait(0.15)
    end
end)

print("=== WEAPONS ONLY ESP CHARG√â ! (GOLD Legendary) ===")
print("INSERT: Toggle ESP | RIGHT SHIFT: Auto Pickup")
print("Seulement AK/MP5/RPG/Remi/Draco/etc. en GOLD ! Pas de cash/money")
print("F9 pour voir les d√©tections. Teste un drop d'arme !")
