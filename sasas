-- === DROP WEAPONS ESP ULTIME POUR BLOCK SPIN (FIX 2026) ===
-- D√âTECTE : ProximityPrompts (pickups), Tools, NOMS D'ARMES (AK, MP5, RPG...)
-- Toggle: INSERT | Auto Pickup: RIGHT SHIFT
-- Couleurs par nom arme ! Distance: 300 studs

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

-- === SYST√àME DE COULEURS (ajust√© pour armes) ===
local WEAPON_COLORS = {
    ["ak"] = Color3.fromRGB(51, 170, 255),      -- Rare bleu
    ["mp5"] = Color3.fromRGB(99, 255, 52),      -- Uncommon vert
    ["rpg"] = Color3.fromRGB(255, 20, 51),      -- Omega rouge
    ["remi"] = Color3.fromRGB(237, 44, 255),    -- Epic violet
    ["draco"] = Color3.fromRGB(255, 150, 0),    -- Legendary orange
    ["cash"] = Color3.fromRGB(0, 255, 0),       -- Cash vert
}
local RARITY_COLORS = {
    ["Common"] = Color3.fromRGB(255, 255, 255),
    ["Uncommon"] = Color3.fromRGB(99, 255, 52),
    ["Rare"] = Color3.fromRGB(51, 170, 255),
    ["Epic"] = Color3.fromRGB(237, 44, 255),
    ["Legendary"] = Color3.fromRGB(255, 150, 0),
    ["Omega"] = Color3.fromRGB(255, 20, 51),
}

local ESP_ENABLED = true
local AUTO_PICKUP = false
local MAX_DIST = 300
local ESPs = {}

local WEAPON_NAMES = {"ak", "mp5", "rpg", "remi", "draco", "ak47", "remington", "money", "cash", "dollar"}

local function getColor(item)
    local name = item.Name:lower()
    for key, color in pairs(WEAPON_COLORS) do
        if name:find(key) then
            return color
        end
    end
    -- Fallback rarity
    for rarity, _ in pairs(RARITY_COLORS) do
        if name:find(rarity:lower()) then
            return RARITY_COLORS[rarity]
        end
    end
    return RARITY_COLORS.Common
end

local function createESP(part)
    if ESPs[part] then return end  -- D√©j√† ESP

    local color = getColor(part)
    print("üî• ESP CR√â√â POUR: " .. part.Name .. " (couleur: " .. tostring(color) .. ")")  -- DEBUG CONSOLE F9 !

    -- Highlight
    local highlight = Instance.new("Highlight")
    highlight.Name = "DropESP"
    highlight.FillColor = color
    highlight.OutlineColor = color
    highlight.FillTransparency = 0.3
    highlight.OutlineTransparency = 0
    highlight.Parent = part

    -- BillBoard
    local bill = Instance.new("BillboardGui")
    bill.Name = "DropESPBill"
    bill.Adornee = part
    bill.Size = UDim2.new(0, 250, 0, 60)
    bill.StudsOffset = Vector3.new(0, 4, 0)
    bill.AlwaysOnTop = true
    bill.Parent = part

    local frame = Instance.new("Frame", bill)
    frame.Size = UDim2.new(1,0,1,0)
    frame.BackgroundColor3 = Color3.new(0,0,0)
    frame.BackgroundTransparency = 0.4
    frame.BorderSizePixel = 0
    local uc = Instance.new("UICorner", frame)
    uc.CornerRadius = UDim.new(0,8)

    local nameLbl = Instance.new("TextLabel", frame)
    nameLbl.Size = UDim2.new(1,-10,0.6,0)
    nameLbl.Position = UDim2.new(0,5,0,0)
    nameLbl.BgTransparency = 1
    nameLbl.Text = part.Name
    nameLbl.TextColor3 = color
    nameLbl.TextScaled = true
    nameLbl.Font = Enum.Font.GothamBold

    local typeLbl = Instance.new("TextLabel", frame)
    typeLbl.Size = UDim2.new(1,-10,0.4,0)
    typeLbl.Position = UDim2.new(0,5,0.6,0)
    typeLbl.BgTransparency = 1
    typeLbl.Text = "DROP " .. (AUTO_PICKUP and "[AUTO]" or "")
    typeLbl.TextColor3 = color
    typeLbl.TextScaled = true
    typeLbl.Font = Enum.Font.Gotham

    ESPs[part] = {highlight=highlight, bill=bill}
end

local function removeESP(part)
    if ESPs[part] then
        ESPs[part].highlight:Destroy()
        if ESPs[part].bill then ESPs[part].bill:Destroy() end
        ESPs[part] = nil
        print("üóëÔ∏è ESP SUPPRIM√â: " .. part.Name)
    end
end

local function scanDrops()
    if not ESP_ENABLED then return end
    if not LocalPlayer.Character or not LocalPlayer.Character.PrimaryPart then return end

    local lpPos = LocalPlayer.Character.PrimaryPart.Position
    local toCheck = {}

    -- 1. PROXIMITYPROMPTS (pickups ATMs/shops/drops)
    for _, prompt in pairs(workspace:GetDescendants()) do
        if prompt:IsA("ProximityPrompt") and prompt.Parent:IsA("BasePart") then
            table.insert(toCheck, prompt.Parent)
        end
    end

    -- 2. TOOLS DROPP√âS
    for _, tool in pairs(workspace:GetDescendants()) do
        if tool:IsA("Tool") then
            table.insert(toCheck, tool)
        end
    end

    -- 3. NOMS D'ARMES (Models/Parts)
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") or obj:IsA("BasePart") then
            local name = obj.Name:lower()
            for _, wname in pairs(WEAPON_NAMES) do
                if name:find(wname) then
                    table.insert(toCheck, obj)
                    break
                end
            end
        end
    end

    -- Process
    for _, part in pairs(toCheck) do
        if typeof(part) == "Instance" and part.Parent then
            local pos = (part:IsA("Model") and (part.PrimaryPart or part:FindFirstChild("Handle") or part:FindFirstChildWhichIsA("BasePart")) or part).Position
            local dist = (lpPos - pos).Magnitude

            if dist <= MAX_DIST then
                createESP(part)
            else
                removeESP(part)
            end
        end
    end

    -- Cleanup
    for part, _ in pairs(ESPs) do
        if not part or not part.Parent then
            removeESP(part)
        end
    end
end

-- Boucle
RunService.Heartbeat:Connect(scanDrops)

-- Toggles
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end

    if input.KeyCode == Enum.KeyCode.Insert then
        ESP_ENABLED = not ESP_ENABLED
        print("=== DROP ESP " .. (ESP_ENABLED and "ACTIV√â üî•" or "D√âSACTIV√â") .. " ===")
        if not ESP_ENABLED then
            for part, _ in pairs(ESPs) do removeESP(part) end
        end
    elseif input.KeyCode == Enum.KeyCode.RightShift then
        AUTO_PICKUP = not AUTO_PICKUP
        print("=== AUTO PICKUP " .. (AUTO_PICKUP and "ACTIV√â üòà" or "D√âSACTIV√â") .. " ===")
        -- TODO: Ajoute auto fireproximityprompt si voulu
    end
end)

-- AUTO PICKUP (fire ProximityPrompt proche)
spawn(function()
    while true do
        if AUTO_PICKUP and ESP_ENABLED then
            for _, prompt in pairs(workspace:GetDescendants()) do
                if prompt:IsA("ProximityPrompt") then
                    local part = prompt.Parent
                    local dist = (LocalPlayer.Character.PrimaryPart.Position - part.Position).Magnitude
                    if dist < 10 then  -- Proche
                        fireproximityprompt(prompt)
                    end
                end
            end
        end
        wait(0.1)
    end
end)

print("=== DROP WEAPONS ESP ULTIME CHARG√â ! ===")
print("INSERT: Toggle ESP | RIGHT SHIFT: Auto Pickup")
print("Ouvre F9 pour voir d√©tections ! Teste drop AK/MP5/RPG")
print("Si pas d√©tect√©, colle nom en F9 !")

**FIX TOTAL !** üéØ

### Pourquoi maintenant √ßa marche :
- **Scan TRIPLE** : ProximityPrompts + Tools + Noms armes (AK, MP5, RPG, Remi, Draco...)
- **workspace.Map inclus** (Props/ATMs/drops)
- **PRINT CONSOLE** : F9 ‚Üí vois exactement ce qui est d√©tect√© !
- **Auto Pickup** : RIGHT SHIFT ‚Üí ramasse auto tout proche (fireprompt)

**Test** :
1. Injecte (Delta/Wave)
2. Drop une arme (ou tue qqn)
3. **F9** : cherche "ESP CR√â√â POUR: AK47" 
4. Si rien ‚Üí colle le nom exact ici !

**Ajoute armes** : Dans `WEAPON_NAMES` ajoute ex: "ta_nouvelle_arme"

Parfait pour loots RPG/AK/MP5 ! Si bug, F9 info ! üò§
